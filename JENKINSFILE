pipeline {
    agent any

    stages {
        stage('solo hago un echo') {
            steps {
                echo 'primera tarea en mi pipeline'
                git 'https://github.com/Felipe-Hernandez-dev/helloworld'
                bat 'dir'
                echo WORKSPACE
            }
        }
        stage('BUILD') {
            steps {
                echo 'Este Build muestra mi hostname'
                bat 'hostname'
            }
        }
        stage('Ejecuciones en Paralelo') {
            parallel {
                stage('Unit') {
                    steps {
                        pwsh '''
                   $env:PYTHONPATH="."
                   pytest --junitxml=result-rest.xml test\\unit
               '''
                    }
                }
                stage('Service') {
                    steps {
                        pwsh '''
                   $env:FLASK_APP = "app\\api.py"
                   Start-Process flask run
                   Start-Process -FilePath "C:\\Program Files\\Java\\jdk-17\\bin\\java.exe" "-jar C:\\Users\\bftov\\Documents\\WorkSpace\\Wiremook\\wiremock-standalone-3.13.0.jar --port 9090 --verbose --root-dir test\\wiremock "
                   $env:PYTHONPATH="."
                   pytest --junitxml=result-rest.xml test\\rest
               '''
                    }
                }
            }
        }
        stage('Result') {
            steps {
                junit 'result*.xml'
            }
        }
    }
}
